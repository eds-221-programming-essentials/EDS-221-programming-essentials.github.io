---
title: "Day 8: Tasks & activities - KEY"
subtitle: "Data visualization"
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
library(tidyverse)
```

## Data wrangling of SF emissions dataset

1. Read in the SF emissions dataset

::: {.callout-important}
## Solution
```{r}
#| include: false
sf_ghg <- read_csv(here::here("course-materials", "eod-practice", "data", "San_Francisco_Communitywide_Greenhouse_Gas_Inventory.csv")) |> 
  janitor::clean_names()
```

```{r}
#| eval: false
sf_ghg <- read_csv(here::here("data", "San_Francisco_Communitywide_Greenhouse_Gas_Inventory.csv")) |> 
  janitor::clean_names()
```
:::

2. Create a summary table of total annual greenhouse gas emissions (only from Emissions_mtCO2e column) by sector_general

::: {.callout-important}
## Solution
```{r}
#| message: false
sf_ghg |> 
  group_by(sector_general) |> 
  summarize(total_annual_mt_co2e = sum(emissions_mt_co2e, na.rm = TRUE))
```
:::

3. Create a summary table of total annual greenhouse gas emissions (only from Emissions_mtCO2e column) by year and commodity type

::: {.callout-important}
## Solution
```{r}
#| message: false
sf_ghg |> 
  mutate(calendar_year = as.numeric(calendar_year),
         commodity_type = as.factor(commodity_type)) |> 
  group_by(calendar_year, commodity_type) |> 
  summarize(total_annual_mt_co2e = sum(emissions_mt_co2e, na.rm = TRUE))
```
:::

4. Create a subset of the data that only contains observations from 2005 on, only for observations where `Sector_Detail2` contains the pattern "PG&E", then limit to columns `Calendar_Year`, `Sector_Detail2` and `Emissions_mtCO2e`.  

::: {.callout-important}
## Solution
```{r}
sf_ghg_subset <- sf_ghg |>
  select(calendar_year, sector_detail2, emissions_mt_co2e) |> 
  filter(calendar_year >= 2005,
         str_detect(sector_detail2, pattern = "PG&E"))
```
:::
