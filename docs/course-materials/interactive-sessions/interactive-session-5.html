<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Interactive Session 5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">EDS 221</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://docs.google.com/document/d/13wWvGrbbH0INB4JHi27EE845Nq3Tlh4SOIfebd2u3Ng/edit?usp=sharing" target="_blank"> 
<span class="menu-text">syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-daily-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">daily materials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-daily-materials">    
        <li>
    <a class="dropdown-item" href="../../course-materials/day1.html">
 <span class="dropdown-text">day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day2.html">
 <span class="dropdown-text">day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day3.html">
 <span class="dropdown-text">day 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day4.html">
 <span class="dropdown-text">day 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day5.html">
 <span class="dropdown-text">day 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day6.html">
 <span class="dropdown-text">day 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day7.html">
 <span class="dropdown-text">day 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day8.html">
 <span class="dropdown-text">day 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day9.html">
 <span class="dropdown-text">day 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../course-materials/day10.html">
 <span class="dropdown-text">day 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EDS-221" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Interactive Session 5</h1>
            <p class="subtitle lead">Functions continued: testing, sourcing, documentation, sharing</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">1. Setup</a></li>
  <li><a href="#warm-up---for-loops-revisited-leslie-matrix" id="toc-warm-up---for-loops-revisited-leslie-matrix" class="nav-link" data-scroll-target="#warm-up---for-loops-revisited-leslie-matrix">2. Warm up - For loops revisited (Leslie Matrix)</a>
  <ul class="collapse">
  <li><a href="#create-the-matrix" id="toc-create-the-matrix" class="nav-link" data-scroll-target="#create-the-matrix">Create the matrix</a></li>
  </ul></li>
  <li><a href="#testing-functions-with-testthat" id="toc-testing-functions-with-testthat" class="nav-link" data-scroll-target="#testing-functions-with-testthat">3. Testing functions with <code>{testthat}</code></a>
  <ul class="collapse">
  <li><a href="#write-the-function" id="toc-write-the-function" class="nav-link" data-scroll-target="#write-the-function">Write the function</a></li>
  <li><a href="#create-some-tests-with-testthat" id="toc-create-some-tests-with-testthat" class="nav-link" data-scroll-target="#create-some-tests-with-testthat">Create some tests with <code>testthat</code></a></li>
  </ul></li>
  <li><a href="#sourcing-functions" id="toc-sourcing-functions" class="nav-link" data-scroll-target="#sourcing-functions">3. Sourcing functions</a>
  <ul class="collapse">
  <li><a href="#a-real-sourcing-example-cork-oak-growth" id="toc-a-real-sourcing-example-cork-oak-growth" class="nav-link" data-scroll-target="#a-real-sourcing-example-cork-oak-growth">A real sourcing example: cork oak growth</a></li>
  </ul></li>
  <li><a href="#function-documentation" id="toc-function-documentation" class="nav-link" data-scroll-target="#function-documentation">4. Function documentation</a></li>
  <li><a href="#making-an-r-package" id="toc-making-an-r-package" class="nav-link" data-scroll-target="#making-an-r-package">5. Making an R package</a></li>
  <li><a href="#finding-vetting-and-using-other-packages" id="toc-finding-vetting-and-using-other-packages" class="nav-link" data-scroll-target="#finding-vetting-and-using-other-packages">6. Finding, vetting and using other packages</a>
  <ul class="collapse">
  <li><a href="#finding-packages" id="toc-finding-packages" class="nav-link" data-scroll-target="#finding-packages">Finding packages</a></li>
  <li><a href="#exploring-vetting-packages" id="toc-exploring-vetting-packages" class="nav-link" data-scroll-target="#exploring-vetting-packages">Exploring / vetting packages</a></li>
  <li><a href="#using-and-citing-packages" id="toc-using-and-citing-packages" class="nav-link" data-scroll-target="#using-and-citing-packages">Using and citing packages</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">1. Setup</h2>
<ul>
<li>Fork then clone <a href="https://github.com/eds-221-programming-essentials/eds221-day5-comp">this repo</a> to create a version-controlled R Project for Day 5</li>
</ul>
</section>
<section id="warm-up---for-loops-revisited-leslie-matrix" class="level2">
<h2 class="anchored" data-anchor-id="warm-up---for-loops-revisited-leslie-matrix">2. Warm up - For loops revisited (Leslie Matrix)</h2>
<p>Open the <code>leslie_projection.Rmd</code> file in docs/. All code shown below for Part 0 is in that file. You should be able to run it out-of-the-box. In EDS 212, we learned about Leslie matrices for projecting populations based on mortality and reproduction for different organism life stages. Let’s return to one example we checked out.</p>
<p>A population of fish we’re interested in has four life stages: eggs (E), fry (F), juvenile (J), breeding adult (A). You are told that annually:</p>
<ul>
<li>Each breeding adult will produce, on average, 200 eggs</li>
<li>5% of eggs will survive to become fry</li>
<li>10% of fry will survive to become juveniles</li>
<li>16% of juveniles will survive to become adults</li>
<li>Adult survival rate year to year is 90%</li>
</ul>
<section id="create-the-matrix" class="level3">
<h3 class="anchored" data-anchor-id="create-the-matrix">Create the matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the Leslie Matrix:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fish_leslie <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">200</span>, <span class="fl">0.05</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.10</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.16</span>, <span class="fl">0.9</span>), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check it out: </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>fish_leslie</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]  [,4]
[1,] 0.00  0.0 0.00 200.0
[2,] 0.05  0.0 0.00   0.0
[3,] 0.00  0.1 0.00   0.0
[4,] 0.00  0.0 0.16   0.9</code></pre>
</div>
</div>
<p>Recall, we are able to use the dot product (<code>%*%</code>) to estimate the population at the next year (we’ll draw this on the board to remember what it looks like).</p>
<p>The initial population structure is given by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial population structure (Roe, Fry, Juvenile, Adult): </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fish_year0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">8000</span>, <span class="dv">600</span>, <span class="dv">400</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ WHAT HAPPENS HERE? ------ #</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>time_yr <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>proj_year <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(fish_year0), <span class="at">nrow =</span> <span class="fu">length</span>(time_yr))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>proj_year[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> fish_year0</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(time_yr)) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  proj_year[i,] <span class="ot">&lt;-</span> fish_leslie <span class="sc">%*%</span> proj_year[i<span class="dv">-1</span>,]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------- #</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># The rest is wrangling &amp; visualization:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(proj_year) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"eggs"</span>, <span class="st">"fry"</span>, <span class="st">"juvenile"</span>, <span class="st">"adult"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>proj_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time_yr, proj_year) <span class="sc">%&gt;%</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>time_yr, <span class="at">names_to =</span> <span class="st">"lifestage"</span>, <span class="at">values_to =</span> <span class="st">"stage_population"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> proj_df, <span class="fu">aes</span>(<span class="at">x =</span> time_yr, <span class="at">y =</span> stage_population)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> lifestage)) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="interactive-session-5_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="testing-functions-with-testthat" class="level2">
<h2 class="anchored" data-anchor-id="testing-functions-with-testthat">3. Testing functions with <code>{testthat}</code></h2>
<ul>
<li>Create a new R Markdown file in your existing project (in docs/) saved as <code>fun_testing.Rmd</code></li>
<li>Install the <code>testthat</code> package (<code>install.packages("testthat")</code>)</li>
<li>Install the <code>devtools</code> package (<code>install.packages("devtools")</code>)</li>
<li>Install the <code>remotes</code> packages (<code>install.packages("remotes")</code>)</li>
</ul>
<p>As we develop algorithms, we’ll change our code. We want a way to automatically check our work to make sure it’s behaving as expected. The <a href="https://testthat.r-lib.org/index.html"><code>testthat</code></a> package “tries to make testing as fun as possible.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Unit test:</strong> A unit test is an automated check of a piece (“unit”) of your code</p>
</div>
</div>
<p>Let’s consider an example. We’re writing a function to find the mean value of each column, then return the lowest and highest mean calculated (in that order). We would expect:</p>
<ul>
<li>The outcome to be a numeric vector of length 2</li>
<li>Where the first value in the vector is smaller than the second value in that vector</li>
</ul>
<section id="write-the-function" class="level3">
<h3 class="anchored" data-anchor-id="write-the-function">Write the function</h3>
<p>Let’s write the function first, then create some accompanying tests to make sure they’re working.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mean_range <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  col_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> df, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># Returns column means as a vector</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  col_mean_max <span class="ot">&lt;-</span> <span class="fu">max</span>(col_means) <span class="co"># Looks for the maximum value in the vector</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  col_mean_min <span class="ot">&lt;-</span> <span class="fu">min</span>(col_means) <span class="co"># Looks for the minimum value in the vector</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(col_mean_min, col_mean_max)) <span class="co"># Prints the vector with minimum &amp; maximum</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Try it out:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean_range</span>(<span class="at">df =</span> mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   0.40625 230.72188</code></pre>
</div>
</div>
<p>OK great. But we’re doing some work on this code, and we don’t want to have to try a bunch of different things manually each time we change it to see how it breaks. Instead, let’s write some <strong>automated tests</strong> for this function that help us avoid that.</p>
</section>
<section id="create-some-tests-with-testthat" class="level3">
<h3 class="anchored" data-anchor-id="create-some-tests-with-testthat">Create some tests with <code>testthat</code></h3>
<p>The <code>testthat</code> package contains a whole bunch of helper functions built for testing. Take a look at <a href="https://testthat.r-lib.org/reference/index.html">options in the package documentation</a>.</p>
<p>Here are some examples of the types of built-in functions for testing:</p>
<ul>
<li><code>expect_length()</code>: does the function return a vector of the expected length?</li>
<li><code>expect_equal()</code>: does the function return an expected value?</li>
<li><code>expect_true()</code>: does the code return <code>TRUE</code> or <code>FALSE</code>?</li>
</ul>
<p>For example, let’s use <code>expect_length()</code> to test our function above, which should return a vector of length 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_length</span>(<span class="fu">mean_range</span>(mtcars), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nothing is returned - that’s passing. You’ll get an error message if the test fails. What if we say the expected length of the vector returned is 3?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_length</span>(<span class="fu">mean_range</span>(mtcars), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: mean_range(mtcars) has length 2, not length 3.</code></pre>
</div>
</div>
<p>Let’s do another one!</p>
<p>For this function to be working correctly, the output of <code>mean_range(mtcars)</code> should have two values and we expect the <strong>first element to be smaller than the second element.</strong></p>
<p>Our test might look something like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(<span class="fu">mean_range</span>(mtcars)[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="fu">mean_range</span>(mtcars)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That passes! What happens if you change the alligator mouth direction?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(<span class="fu">mean_range</span>(mtcars)[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="fu">mean_range</span>(mtcars)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: mean_range(mtcars)[1] &gt; mean_range(mtcars)[2] is not TRUE

`actual`:   FALSE
`expected`: TRUE </code></pre>
</div>
</div>
<p>That test fails. This is just a little flavor of what unit tests do.</p>
</section>
</section>
<section id="sourcing-functions" class="level2">
<h2 class="anchored" data-anchor-id="sourcing-functions">3. Sourcing functions</h2>
<p>When you’re writing functions (or working with someone else’s functions), often they’re not stored in the actual script or notebook you’re working in. If that’s the case, you can still use them by <strong>sourcing</strong> a function.</p>
<p>Let’s make a function that’s stored in a script, save it in our project working directory, and use it in an R Markdown document.</p>
<ul>
<li>Create a new R script (File &gt; New File &gt; R Script)</li>
<li>Save the script in your project</li>
</ul>
<p>In our new R script, let’s write a function that, when given inputs of the user’s favorite food and animal, returns the name of their future food cart.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>name_cart <span class="ot">&lt;-</span> <span class="cf">function</span>(food, animal) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mc"</span>, stringr<span class="sc">::</span><span class="fu">str_to_title</span>(animal), <span class="st">"'s "</span>, stringr<span class="sc">::</span><span class="fu">str_to_title</span>(food), <span class="st">"Mart"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Try it out: </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">name_cart</span>(<span class="at">food =</span> <span class="st">"burrito"</span>, <span class="at">animal =</span> <span class="st">"pika"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the script with a descriptive name, e.g.&nbsp;<code>food_cart_functions.R</code> (this could, in theory, contain multiple functions). Atop our .Rmd (in the setup chunk), we’ll <strong>source</strong> the script so we have access to its functions. Mine will look like this:</p>
<p><code>source("food_cart_functions.R")</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may have your scripts in a subfolder (e.g.&nbsp;R/ or something) - you can use <code>here::here()</code> within the <code>source()</code> function to point to the right place within your R Project as needed.</p>
</div>
</div>
<p>Now, add a code chunk in your R Markdown document that uses the <code>name_cart()</code> function you’ve created. It works over here, too!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name_cart</span>(<span class="at">food =</span> <span class="st">"strawberry"</span>, <span class="at">animal =</span> <span class="st">"marmot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "McMarmot's StrawberryMart"</code></pre>
</div>
</div>
<p>This gives us a valuable tool for organizing things within a project. Often, you’ll have a separate folder called <code>R</code> where you have your scripts / functions, and those are sourced as needed for use in your notebook or by another script you’re working on.</p>
<section id="a-real-sourcing-example-cork-oak-growth" class="level3">
<h3 class="anchored" data-anchor-id="a-real-sourcing-example-cork-oak-growth">A real sourcing example: cork oak growth</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Citation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mariola Sánchez-González, Margarida Tomé, Gregorio Montero. Modelling height and diameter growth of dominant cork oak trees in Spain. Annals of Forest Science, Springer Nature (since 2011)/EDP Science (until 2010), 2005, 62 (7), pp.633-643.</p>
</div>
</div>
<p>In the <code>src/</code> folder there is a script <code>cork_oak_growth.R</code> that contains one function <code>height_t2</code> that estimates the height of a cork oak tree at some age (time 2), given a prior height of the tree, the age when that height was recorded (years), and the age you’re trying to estimate the new height for (these ages are t1 and t2, respectively, in the model).</p>
<p>Create a new .Rmd. Source the script by running <code>source(here::here("path", "to", "script.R"))</code> in your setup chunk. Ensure that you can use the function in your .Rmd whenever you want to.</p>
</section>
</section>
<section id="function-documentation" class="level2">
<h2 class="anchored" data-anchor-id="function-documentation">4. Function documentation</h2>
<p>Documentation is a really important part of data science. Remember: “past you doesn’t respond to emails” (Wickham). I’ll also add that present you will forget things immediately, and future you is a grump. So make sure, for your sake and the sake of your collaborators, you <strong>document</strong> your functions (along with any useful annotation throughout your work) to make them easier for you to use later on.</p>
<p>It’s important to note here that documentation can mean different things.</p>
<p>Informally, this can mean adding relevant comments to your script so that you know:</p>
<ul>
<li>Arguments expected (name and units)</li>
<li>Variable types expected (and output)</li>
<li>A summary of what the function does</li>
<li>An example of how it works</li>
<li>Any citations / relevant information</li>
</ul>
<p>Formally, in R, the <code>{roxygen2}</code> package can help guide our documentation.</p>
<p>Let’s try creating some documentation for a little function. Write a function to calculate the maximum sustained harvest (<span class="math inline">\(H\)</span>), given a fishery carrying capacity (<span class="math inline">\(K\)</span>) and intrinsic growth rate, <span class="math inline">\(r\)</span>:</p>
<p><span class="math display">\[H = \frac{Kr}{4}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the functio</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>max_sustainable_harvest <span class="ot">&lt;-</span> <span class="cf">function</span> (K, r) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  harvest <span class="ot">&lt;-</span> (K <span class="sc">*</span> r) <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(harvest)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Try it out: </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">max_sustainable_harvest</span>(<span class="at">K =</span> <span class="dv">36000</span>, <span class="at">r =</span> <span class="fl">0.31</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2790</code></pre>
</div>
</div>
<p>Now, how can we document this function?</p>
<p>We’ll use what’s called a <em>Roxygen Skeleton</em> - a skeleton set of documentation that prompts us to input important information about our function. <strong>Note:</strong> this exercise is just so you get a feel for what a roxygen skeleton looks like.</p>
<p>To add a Roxygen Skeleton:</p>
<ul>
<li>Click anywhere within your function</li>
<li>In RStudio, go up to ‘Code’ in the top menu, and click ‘Insert Roxygen Skeleton’</li>
<li>Immediately above your function, you should see some auto-added text that looks like this (your parameters will already be added):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Title</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param  </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param  </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Update the fields with descriptions and types</p>
<ul>
<li><code>@param</code>: information about the parameters (arguments) in your function</li>
<li><code>@return</code>: information about what the function <em>returns</em> to the user</li>
<li><code>@export</code>: we’ll return to this, but this lets an R package know that this is a function available for the user to use (not an internal function)</li>
<li><code>@examples</code>: add helpful examples for the user</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Maximum sustainable harvest</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' A little function to return the maximum sustainable harvest given the carrying capacity and growth rate.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param K A number indicating the carrying capacity of the fishery (in individuals)  </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param r A number indicating the intrinsic growth rate of the fishery (in 1 / yr)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A number indicating the maximum annual sustainable harvest for the fishery</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' max_sustainable_yield(K = 3.8e5, r = 0.62)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So overall, our function code chunk might look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Maximum sustainable harvest</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' A little function to return the maximum sustainable harvest given the carrying capacity and growth rate.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param K A number indicating the carrying capacity of the fishery (in individuals)  </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param r A number indicating the intrinsic growth rate of the fishery (in 1 / yr)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A number indicating the calculated maximum annual sustainable harvest for the fishery</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' max_sustainable_harvest(K = 3.8e5, r = 0.62)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>max_sustainable_harvest <span class="ot">&lt;-</span> <span class="cf">function</span> (K, r) {</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  harvest <span class="ot">&lt;-</span> (K <span class="sc">*</span> r) <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(harvest)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Try it out: </span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">max_sustainable_harvest</span>(<span class="at">K =</span> <span class="dv">36000</span>, <span class="at">r =</span> <span class="fl">0.31</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2790</code></pre>
</div>
</div>
<p>Now, this might seem weird because it’s not obvious how that odd formatting of the Roxygen Skeleton actually helps. Why not just make them normal comments, and it words that a human can easily read?</p>
<p>The answer is: because this structure and syntax will make it possible for us to store our documentation as part of an R package containing our function. And that’s what we want to do next…</p>
</section>
<section id="making-an-r-package" class="level2">
<h2 class="anchored" data-anchor-id="making-an-r-package">5. Making an R package</h2>
<p>Let’s put a bunch of what we’ve been working on together into an R package that you can use, <em>and</em> share with others so they can use your amazing function!</p>
<p>Step-by-step:</p>
<ol type="1">
<li><p>In RStudio, new R Project &gt; New directory &gt; R package</p></li>
<li><p>Name your R package something awesome, like your favorite food and favorite animal (e.g.&nbsp;tacopika)</p></li>
<li><p>Save your new package project in your EDS 221 folder, and open your project in a new session</p></li>
<li><p>Hey, you made an R package!</p>
<ul>
<li>Some placeholder example stuff exists in it already</li>
<li>Including a single function called <code>hello()</code> that prints the worlds “Hello, world!”</li>
<li>The function is saved in a single .R script, with the same name, within the <code>R</code> folder</li>
</ul></li>
<li><p>Wait you made an R package? Yup try it out.</p>
<ul>
<li>Go up to the Build tab, and click ‘Install and restart’</li>
<li>You should see that your package is attached (see <code>library(your_package_name)</code> in the Console)</li>
<li>Now you can use any of the exported functions - which so far is only <code>hello()</code>. Try it!</li>
</ul></li>
<li><p>OK but let’s <em>really</em> make it your own…</p></li>
</ol>
<ul>
<li><p>Create a new R script in your project</p></li>
<li><p>Create a function within the script of your choosing (you’ll share this with a classmate). Some requirements:</p>
<ul>
<li>It must have at least 3 parameters</li>
<li>Of those 3 parameters, at least one must be a character, and one numeric</li>
</ul></li>
<li><p>Save the script <strong>in the R subfolder with the same name as your function.</strong> For example, if your function is called <code>jurassic_park()</code>, then the script should be saved in the R folder as <strong>jurassic_park.R</strong>.</p></li>
<li><p>Click ‘Install and restart’ in the Build tab again</p></li>
<li><p>Try your new function!</p></li>
</ul>
<ol start="7" type="1">
<li>Documenting your function</li>
</ol>
<p>So that’s cool that your new function exists within the package and you can use it. But now try checking the documentation on your function using <code>?function_name</code>. What shows up? Zilch, right?</p>
<p>We want to add documentation for our function that we can check it out whenever we use the function, and so that other users will have critical information about what it does and how it works.</p>
<ul>
<li>In the script with your function, click anywhere within your function</li>
<li>Add a roxygen skeleton (Code &gt; Insert Roxygen Skeleton)</li>
<li>Update your documentation with at least a new title and parameter descriptions. Save.</li>
<li>Run <code>devtools::document()</code> (note: if you see ‘Warning: Namespace not generated by Roxygen2’, you should delete the existing NAMESPACE file, then run <code>devtools::document()</code> again to resolve)</li>
<li>Something new is created - check the <code>man/</code> folder and see that an .Rd (R documentation) file has been added that is associated with your function name, and that contains your updated documentation</li>
<li>Press Install and restart in the Build tab</li>
<li>Check for your function documentation - does it exist now? Cool!</li>
</ul>
<p>Things to remember:</p>
<ul>
<li>Run <code>devtools::document()</code> any time you update your function or documentation</li>
<li>You must use <code>Install and restart</code> to see the changes when you test</li>
</ul>
<ol start="8" type="1">
<li>Sharing your package</li>
</ol>
<p><strong>Putting it on GitHub</strong></p>
<p>Your friends and family will definitely want to use the amazing R package you’ve just created. How can <em>they</em> install and use it?</p>
<p>Collaborators can install your package straight from a GitHub repo. Let’s put it up there.</p>
<ul>
<li>In your package project, run <code>usethis::use_git()</code></li>
<li>Then run <code>usethis::use_github()</code></li>
</ul>
<p>This should take you to your new GitHub repo for the package.</p>
<p><strong>Installing a package from GitHub</strong></p>
<p>Once your package is in a public repo on GitHub, anyone can install its contents by running:</p>
<pre><code>`remotes::install_github("username/reponame")`</code></pre>
<p>For example, if my package is in a repo called <code>tacopika</code>, then someone could install that package of mine using:</p>
<pre><code>`remotes::install_github("ryoliver/tacopika")`</code></pre>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can check all functions in a package by running <code>lsf.str("package:packagename")</code> in the console. For example, after installing the package <code>tacopika</code> above, running <code>lsf.str("package:tacopika")</code> in the Console will return all functions in it.</p>
</div>
</div>
</section>
<section id="finding-vetting-and-using-other-packages" class="level2">
<h2 class="anchored" data-anchor-id="finding-vetting-and-using-other-packages">6. Finding, vetting and using other packages</h2>
<p>Now that you’ve made your own package, let’s dive into packages that <em>other</em> developers have made so that we do more data science and less reinventing the wheel with code to do common useful things.</p>
<p>Let’s spend a bit of time learning how to search for, choose, investigate put to use some R &amp; Python Packages.</p>
<section id="finding-packages" class="level3">
<h3 class="anchored" data-anchor-id="finding-packages">Finding packages</h3>
<ul>
<li><p>CRAN Task Views (search by topic): <a href="https://cran.r-project.org/web/views/" class="uri">https://cran.r-project.org/web/views/</a></p></li>
<li><p>Microsoft R Application Network (MRAN) (search by keywords): <a href="https://mran.microsoft.com/packages" class="uri">https://mran.microsoft.com/packages</a></p></li>
<li><p>Some trusted &amp; awesome package sources:</p>
<ul>
<li>ROpenSci: <a href="https://ropensci.org/packages/" class="uri">https://ropensci.org/packages/</a></li>
<li>RStudio: <a href="https://www.rstudio.com/" class="uri">https://www.rstudio.com/</a></li>
<li>pyOpenSci: <a href="https://www.pyopensci.org/" class="uri">https://www.pyopensci.org/</a></li>
</ul></li>
<li><p>Other great places to learn about package updates, releases, use:</p>
<ul>
<li>#rstats on Twitter (seriously)</li>
<li><a href="https://rviews.rstudio.com/">R Views blog</a> by Joseph Rickert</li>
<li>Also…just a lot of googling (and using useful keywords, e.g.&nbsp;“tidyverse”)</li>
</ul></li>
</ul>
</section>
<section id="exploring-vetting-packages" class="level3">
<h3 class="anchored" data-anchor-id="exploring-vetting-packages">Exploring / vetting packages</h3>
<p><strong>Explore packages:</strong></p>
<ul>
<li>Usually, on their GitHub repo</li>
<li>Contributors</li>
<li>Activity (recent commits?)</li>
<li>Issues (and responses)?</li>
<li>How many packages depend on this packages?</li>
</ul>
<p><strong>Dig a bit deeper:</strong></p>
<ul>
<li>Source code</li>
<li>pkgdown website</li>
<li>relevant citations</li>
</ul>
</section>
<section id="using-and-citing-packages" class="level3">
<h3 class="anchored" data-anchor-id="using-and-citing-packages">Using and citing packages</h3>
<p><strong>Installation</strong></p>
<p>We’ve seen the two main ways you’ll install R packages:</p>
<ul>
<li>From CRAN (using <code>install.packages("packagename")</code>)</li>
<li>From GitHub (using <code>devtools::install_github("username/packagename")</code> or <code>remotes::install_github("username/packagename"</code>)</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are other ways to get R packages. For example, <a href="https://www.bioconductor.org/">Bioconductor</a> provides “open source software for bioinformatics” and is home to a lot of great software &amp; packages for genomics work. See the Bioconductor <a href="https://www.bioconductor.org/install/">installation page</a> for information about how to install their packages &amp; tools.</p>
</div>
</div>
<p>What about Python packages? We haven’t dealt with this at all, since <em>most</em> of the packages we need are installed with Anaconda. What id we need something different?</p>
<p>Follow along to make sure you can install packages with pip:</p>
<ul>
<li><p>Open the Terminal</p></li>
<li><p>Check for pip by running the appropriate commands (make sure you choose the correct one for your OS)</p></li>
<li><p>Install pip if necessary (follow along with commands <a href="https://packaging.python.org/tutorials/installing-packages/#ensure-you-can-run-pip-from-the-command-line">here</a>)</p></li>
<li><p>Install Python packages by running the following in the command line, replacing “project_name”:</p>
<ul>
<li>MacOS: <code>python3 -m pip install "project_name"</code></li>
<li>Windows: <code>py -m pip install "project_name"</code></li>
</ul></li>
</ul>
<p>For example, I have pip installed. To install the <code>seaborn</code> package, I run: <code>python3 -m pip install "seaborn"</code></p>
<p><strong>Go ahead and try it:</strong> Use the appropriate command for your OS to install the Python version of the <code>palmerpenguins</code> package (also named <code>palmerpenguins</code>).</p>
<p><strong>Use and responsibility</strong></p>
<p>Anyone can make and publish an R or Python package to GitHub. That means it is <em>your</em> responsibility to determine if it is safe to use for your science. Once you’ve sufficiently explored, vetted and tested a package, the next step is to use it.</p>
<p><strong>Citing packages</strong></p>
<p>Open source software is a major contribution to science and deserves to be credited. Often, developers are creating and maintaining packages voluntarily and without pay or support. Please remember to cite software and tools that helps you with your work.</p>
<p>Luckily, packages (at least those on CRAN) come with a built-in citation to make it easy for you to see the citation. Use <code>citation(packagename)</code> to return package citation.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">"palmerpenguins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite palmerpenguins in publications use:

  Horst AM, Hill AP, Gorman KB (2020). palmerpenguins: Palmer
  Archipelago (Antarctica) penguin data. R package version 0.1.0.
  https://allisonhorst.github.io/palmerpenguins/. doi:
  10.5281/zenodo.3960218.

A BibTeX entry for LaTeX users is

  @Manual{,
    title = {palmerpenguins: Palmer Archipelago (Antarctica) penguin data},
    author = {Allison Marie Horst and Alison Presmanes Hill and Kristen B Gorman},
    year = {2020},
    note = {R package version 0.1.0},
    doi = {10.5281/zenodo.3960218},
    url = {https://allisonhorst.github.io/palmerpenguins/},
  }</code></pre>
</div>
</div>
<p>And an aside: R Markdown now makes it pretty nice to interface between your Zotero libraries and your R Markdown document. In the Visual Editor mode for R Markdown, you should see an `@` symbol. Clicking on it (if you have Zotero) should bring up your libraries.<br>
<br>
Select the citation you want to insert. For example, data used in this example are from the <code>palmerpenguins</code> R package <span class="citation" data-cites="horst2020a">(<a href="#ref-horst2020a" role="doc-biblioref">Horst, Presmanes Hill, and Gorman 2020</a>)</span>.</p>
<p>Click on the citation text for a preview of how it’ll show up in the final document!</p>
<p>Learn more about citations in R Markdown: <a href="https://blog.rstudio.com/2020/11/09/rstudio-1-4-preview-citations/" class="uri">https://blog.rstudio.com/2020/11/09/rstudio-1-4-preview-citations/</a></p>
<div class="center-text body-text-xl teal-text">
<p>End Interactive Session 5</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Extra unit test example (from lecture):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fish_mass <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha, beta, fish_length) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fish_length <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Fish length must be greater than or equal to 0."</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  mass <span class="ot">&lt;-</span> alpha <span class="sc">*</span> (fish_length <span class="sc">^</span> beta)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mass)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Unit tests</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_length</span>(<span class="fu">fish_mass</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">beta =</span> <span class="dv">2</span>, <span class="at">fish_length =</span> <span class="dv">3</span>), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: fish_mass(alpha = 1, beta = 2, fish_length = 3) has length 1, not length 2.</code></pre>
</div>
</div>
<p>Extra Roxygen example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Calculate the distance traveled in miles</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param rate a number in units of miles per hour</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param time a number in units of hours</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a number indicating the distance traveled in miles</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, time) {</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> rate <span class="sc">*</span> time</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dist)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-horst2020a" class="csl-entry" role="listitem">
Horst, Allison, Alison Presmanes Hill, and Kristen B Gorman. 2020. <em>Palmerpenguins: Palmer Archipelago (Antarctica) Penguin Data</em>. <a href="https://allisonhorst.github.io/palmerpenguins/">https://allisonhorst.github.io/palmerpenguins/</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><img src="images/bren-logo.png" alt="The Bren School of Environmental Science &amp; Management logo" width="250"></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://github.com/samanthacsik/EDS-212-essential-math"><i class="fa-brands fa-github" title="the github octocat logo" aria-label="github"></i></a>, <a href="https://www.r-project.org/about.html"><i class="fa-brands fa-r-project" title="R Project" aria-label="r-project"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>